<!DOCTYPE html>
<html>
<head>
    <title>Donation DApp</title>

    <!-- Load Ethers.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>

    <style>
        body {
            font-family: Arial;
            background: #111;
            color: white;
            text-align: center;
            padding-top: 50px;
        }
        button {
            padding: 10px 18px;
            margin: 10px;
            font-size: 18px;
            cursor: pointer;
            border-radius: 8px;
            border: none;
            background: #ff8c00;
            color: black;
        }
    </style>
</head>
<body>

    <h1>Donation Smart Contract</h1>

    <button onclick="connectWallet()">Connect Wallet</button>
    <br><br>

    <input id="amount" type="text" placeholder="Enter ETH to donate">
    <button onclick="donate()">Donate</button>
    <br><br>

    <button onclick="withdraw()">Withdraw (Owner Only)</button>

<script>

let provider;
let signer;
let contract;

// --------------------------------------
//  Your Contract Details
// --------------------------------------
const contractAddress = "0xd6aa384d4B5C67884B2d8D91D581b7DafcE478C1";   // <--- CHANGE THIS
const contractABI = [
	{
		"inputs": [],
		"name": "donate",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [],
		"name": "withdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getBalance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "totalDonations",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];                      // <--- CHANGE THIS

// --------------------------------------
//  Connect Wallet Function
// --------------------------------------
async function connectWallet() {
    if (!window.ethereum) {
        alert("MetaMask is not installed!");
        return;
    }

    try {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();

        const userAddress = await signer.getAddress();
        alert("Wallet Connected: " + userAddress);

        contract = new ethers.Contract(contractAddress, contractABI, signer);

    } catch (err) {
        console.error(err);
        alert("Wallet connection failed");
    }
}

// --------------------------------------
//  Donate Function
// --------------------------------------
async function donate() {
    if (!contract) return alert("Connect wallet first!");

    let ethValue = document.getElementById("amount").value;

    try {
        let tx = await contract.donate({
            value: ethers.utils.parseEther(ethValue)
        });

        alert("Transaction Sent! Hash: " + tx.hash);

        await tx.wait();
        alert("Donation Successful!");

    } catch (err) {
        console.error(err);
        alert("Donation Failed!");
    }
}

// --------------------------------------
//  Withdraw Function (Owner Only)
// --------------------------------------
async function withdraw() {
    if (!contract) return alert("Connect wallet first!");

    try {
        let tx = await contract.withdraw();
        alert("Withdraw Transaction: " + tx.hash);

        await tx.wait();
        alert("Funds Withdrawn!");

    } catch (err) {
        console.error(err);
        alert("Withdraw Failed!");
    }
}

</script>

</body>
</html>
